%
O9801(REN*ALL*CALIB)
(F-4012-0519-AV)
(COPYRIGHT*1990-2022*RENISHAW*PLC.*ALL*RIGHTS*RESERVED)
()
IF[#[#111+5]AND256EQ256]GOTO10
G65P9700E380.
N10
IF[#[#111+5]AND2048EQ2048]GOTO20
#[#111+5]=1280(SET: NOT OPTIM/O9832 FLAGS)
GOTO30
N20
#[#111+5]=2304(SET: OPTIM/O9832 FLAGS)
N30
()
G65P9724E1.
#31=#5041
#32=#5042
#12=#5043-#116
IF[#6NE#0]GOTO40
#6=1
N40
IF[#6EQ0]GOTO50
IF[#6EQ1]GOTO50
IF[#6EQ2]GOTO50
IF[ABS[#6]EQ3]GOTO50
IF[ABS[#6]EQ4]GOTO50
IF[#6EQ5]GOTO50
G65P9700E360.
N50
#149=90
IF[#2EQ#0]GOTO390
#22=#2/2
IF[#6EQ1]GOTO60
#149=110
IF[#7EQ#0]GOTO390
N60
IF[#6EQ0]GOTO70
IF[#6EQ3]GOTO70
IF[#6EQ4]GOTO70
IF[#19EQ#0]GOTO70
G65P9700E250.
N70
IF[#17NE#0]GOTO80
#17=10.*#129
N80
IF[#6EQ1]GOTO90
IF[#6EQ5]GOTO90
GOTO100
N90
#149=160
IF[#20EQ#0]GOTO390
#149=190
IF[#26EQ#0]GOTO400
N100
IF[#8EQ#0]GOTO110
#149=200
IF[#24EQ#0]GOTO390
IF[#25EQ#0]GOTO390
N110
#149=#0
#16=#26
#[#111+5]=#[#111+5]OR128(SET: O9801 FLAG)
IF[#6NE1]GOTO120
#[#111+19]=#22/#129
GOTO320
N120
IF[#26EQ#0]GOTO130
IF[#18NE#0]GOTO130
#18=5.*#129
N130
#15=#18(SAVE #18)
(LOAD DEFAULT Z BALL RADS)
IF[ABS[#[#111+18]-[#22/#129]]LT1]GOTO140
#[#111+18]=#22/#129
N140
IF[ABS[#[#111+19]-[#22/#129]]LT1]GOTO150
#[#111+19]=#22/#129
N150
IF[#6NE5]GOTO160
#[#111+0]=#22/#129
#[#111+1]=#22/#129
#14=#26+[#7/2]
G65P9721D#7Q#17R#18Z[#26-#22]
IF[#149NE0]GOTO390
G65P9722D#7Q#17R#18Z[#26-#22]
IF[#149NE0]GOTO390
M98P9723
G65P9726Z[#14-[7*#129]]F[30*#129]
IF[#149NE0]GOTO390
#9=[#126-#116]-#14
#16=#26+#9-#22
N160
IF[ABS[#6]EQ2]GOTO170
IF[#6EQ0]GOTO170
#[#111+0]=#22/#129
#[#111+1]=#22/#129
N170
IF[#6LT0]GOTO180
#[#111+2]=0
#[#111+3]=0
N180
M5
IF[#6NE0]GOTO190
IF[#13NE#0]GOTO190
#149=150
GOTO390
N190
M98P9723
()
(FIND FEATURE CTR: SPINNING 0 OR 180)
()
IF[#13EQ180]GOTO210
IF[#13EQ3]GOTO200
G65P9833J1.
M19(0*SPDL*POS)
G65P9832J1.
GOTO220
N200
S400
M3
IF[#26NE#0]GOTO220
#18=2.*#129
GOTO220
N210
M98P9723
G65P9833J1.
#1133=18000
M214(180*SPDL*POS)
G65P9832J1.
N220
G04X0.5
IF[#13EQ3]GOTO230
IF[#13NE180]GOTO240
N230
G65P9721D#7Q#17R#18Z#16M#13
IF[#149NE0]GOTO390
G65P9722D#7Q#17R#18Z#16M#13
IF[#149NE0]GOTO390
#28=#128(ROT CTR / 180 Y1)
G65P9721D#7Q#17R#18Z#16M#13
IF[#149NE0]GOTO390
#27=#127(ROT CTR / 180 X1)
N240
G65P9724E1.
()
(ACCURATELY FIND SPHERE Z POSITION)
()
N250
G65P9833J1.
M19(0*SPDL*POS)
G65P9832J1.
G04X0.5
#18=#15
G65P9721D#7Q#17R#18Z#16
IF[#149NE0]GOTO390
G65P9722D#7Q#17R#18Z#16
IF[#149NE0]GOTO390
#15=[#128+#28]/2(Y FEATURE CTR)
#10=ABS[#7/2-ABS[#125-#128]]/#129
G65P9721D#7Q#17R#18Z#16
IF[#149NE0]GOTO390
#14=[#127+#27]/2(X FEATURE CTR)
#29=ABS[#7/2-ABS[#124-#127]]/#129
()
(SET ARTEFACT CTR STYLUS OFFSETS & RADS)
()
IF[#13EQ180]GOTO270
IF[#13NE3]GOTO260
#14=#27(M3: X CTR)
#15=#28(M3: Y CTR)
GOTO270
N260
#14=#31(M#0: X CTR)
#15=#32(M#0: Y CTR)
N270
G65P9833J1.
M19(0*SPDL*POS)
G65P9832J1.
G4X0.5
#145=#14(SAVE X FEATURE CTR)
#146=#15(SAVE Y FEATURE CTR)
M98P9723
#133=#5021
#134=#5022
#130=#14-#31
#131=#15-#32
IF[#13NE180]GOTO280
#130=#14
#131=#15
N280
IF[#6EQ0]GOTO410
IF[#6EQ1]GOTO420
IF[#6EQ[-3]]GOTO290
IF[#6EQ[-4]]GOTO290
#[#111+2]=[#14-#127]/#129
#[#111+3]=[#15-#128]/#129
IF[#6EQ2]GOTO410
N290
#[#111]=#29
#[#111+1]=#10
IF[[#[#111+5]AND1024]EQ1024]GOTO300
G65P9722D#7Q#17R#18Z#16F[100*#129]
IF[#149NE0]GOTO390
#30=ABS[#7/2-ABS[#125-#128]]/#129
G65P9721D#7Q#17R#18Z#16F[100*#129]
IF[#149NE0]GOTO390
#29=ABS[#7/2-ABS[#124-#127]]/#129
#29=[#29+#30]/2
#30=[#[#111+0]+#[#111+1]]/2
#[#111+4]=#30-#29
N300
IF[ABS[#6]EQ3]GOTO410
#2=30(VECTOR CALIBRATION)
IF[#18LT0]GOTO310
IF[#26EQ#0]GOTO310
#2=210
N310
#5=0
#4=#111+10
#1=0
WHILE[#1LT4]DO2
WHILE[#5LT2]DO1
G65P9727A#2Q#17D#7Z#16R#18
IF[#149NE0]GOTO390
#29=[#124-#127]*[#124-#127]
#30=[#125-#128]*[#125-#128]
#29=SQRT[#29+#30]
#[#4+#5]=ABS[[#7/2]-#29]/#129
#5=#5+1
#2=#2+30
END1
#1=#1+1
#2=#2+30
#5=0
#4=#4+2
END2
G01X#145Y#146F#119
IF[ABS[#6]EQ4]GOTO410
N320(LENGTH SET)
IF[#6NE1]GOTO330
#14=#26
GOTO360
N330
IF[#8NE#0]GOTO340
G01X[#145-[#[#111+2]*#129]]Y[#146-[#[#111+3]*#129]]F#119
#14=#26+[#7/2]
GOTO360
N340
G65P9732S1.W2.
#14=#8-#118
IF[#5003GE[#14+[5*#129]]]GOTO350
G65P9725Z[#14+[5*#129]]F#119
IF[#149NE2]GOTO390
N350
G65P9725X[#24-[#5021-#5041]]Y[#25-[#5022-#5042]]Z#5003F#119
IF[#149NE2]GOTO390
G65P9725Z[#14+[5*#129]]F#119
IF[#149NE2]GOTO390
N360
G65P9726Z#14Q#17S[#[#111+19]*#129]
IF[#149NE0]GOTO390
#3=[#126-#116]-#14
IF[[#[#111+5]AND2048]EQ2048]GOTO362
G1Z[#126-#116+[.5*#129]]F#113
GOTO365
N362
G1Z[#126-#116+[700*#[#111+7]/1000*#129]]F#113
N365
G04X.3(DWELL*SG*PROBE)
#3004=2
G65P9725Z[#126-#116-#17]F[15*#129]
#3004=0
IF[#149NE0]GOTO390
G1Z[#126-#116+[10*#129]]F#113
#21=[#[#111+8]*#129]*[#5063-#126]/[[#[#111+8]-15]*#129]
#21=[#21+[0.0015*#129]]
#[#111+18]=[[#22-#21]/#129]
#[#111+19]=[#22/#129]
#27=11000(L*WEAR)
#28=10000(L*GEOM)
#[#28+#20]=#[#28+#20]+[#3+#21]
IF[#120AND3EQ1]GOTO370
#[#28+#20]=#[#28+#20]+#[#27+#20]
#[#27+#20]=0
N370
G43H#4111Z#5003
M98P9723
#116=#5043-#5003
IF[#8EQ#0]GOTO380
IF[#5003GE#12]GOTO380
G65P9725Z#12F#119
N380
GOTO410
N390
IF[#8EQ#0]GOTO400
IF[#5003GE#12]GOTO400
G65P9725Z#12F#119
N400
G01Z#12F#119
G01X#31Y#32F#119
G65P9700
GOTO440
N410
IF[#19EQ#0]GOTO420
#140=#130
#141=#131
G65P9732S#19W1.
N420
IF[#6NE1]GOTO430
#1=130
WHILE[#1LE149]DO1
#[#1]=#0
#1=#1+1
END1
#142=#3+#21
#137=#26+#142
#144=#142+[#5023-#5043]
GOTO440
N430
#140=#130
#141=#131
#142=#0
#143=#133
#144=#134
#1=130
WHILE[#1LE139]DO1
#[#1]=#0
#1=#1+1
END1
#135=#145
#136=#146
#145=#0
#146=#0
N440
#[#111+5]=#[#111+5]OR128(RESET: O9801 FLAG)
#[#111+5]=#[#111+5]XOR128
M99
%
