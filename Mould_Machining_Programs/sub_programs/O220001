%
O220001 (for AC dimples measurement & kakou)
(level 2: mainly moving along row)

IF[#01EQ#0]GOTO800
IF[#01EQ0]GOTO800
(if A = 0 or empty, to N800)

IF[#01LT0]GOTO001
#33=1 (for A)
GOTO002
N001
#33=-1 (for C)

N002
#734=#5002
#735=#5003
(#734= current work block end Y)
(#735= current work block end Z)

#736=FIX[#13/2]
#737=#19/#04+1
#738=#09/#04+1
(#736= # of even row)
(#737= # of dimple of even rows)
(#738= # of dimple of odd rows)

IF[[#13/2]EQ#736]GOTO003
#32=#09/2
GOTO004
N003
#32=#19/2
(if #13 is odd, #32=#09/2)
(if #13 is even, #32=#19/2)

N004
#739=[#32*2]/#04+1
(#739= the number of dimple)
IF[#4111EQ50]GOTO005
(if H#=50, go to N005)
GOTO006

N005 (for sensor)
G91 G31 Y-#32 Z-[#33*[#24/2]*SIN[ABS[#02]]] F1500
(YZ skip to the 1st dimple: X: faceA-10 or faceC+10)
GOTO007

N006 (for kakou)
G91 G01 Y-#32 Z-[#33*[#24/2]*SIN[ABS[#02]]]
(YZ to the 1st dimple: X: faceA-5 or faceC+5)

N007
#31=1
#30=900001+#717*100+#736*#738+FIX[[#13-1]/2]*#737
(#30: numbering for dimples)
(A:#900101-, C:#900201-)
WHILE[#31LE#739]DO1
IF[#4111NE50]GOTO100
(if H# is not 50, go to N100)
(for sensor)
G65P230001 I#33
(measurement for AC dimples)
#[#30]=#768
GOTO101
N100 (for kakou)
G65P630001 I#33 U#21 W#[#30]
(kakou for AC dimples)
N101
#30=#30+1
IF[#31GE#739]GOTO008 (end loop)
IF[#4111NE50]GOTO102
(if H# is not 50, go to N102)
G91 G31 Y#04 F1500
GOTO103
N102
G91 G01 Y#04
N103
#31=#31+1
END1

N008
G90 G01 Y#734 Z#735 F6400
(YZ: to start point)
GOTO999

N800 #3000=121 (are the arguments or the mould OK?)
M00 (are arguments ok?)

N999 M99

(Used Variables and Programs)

(Local variables)

(as received arguments)
(used only as variables)
(#01:A: face A>0: A, A<0: C)
(#02:B: angle)
(#04:I: X pitch)
(#09:F: length of odd rows)
(#13:M: number of rows)
(#19:S: length of even rows)
(#24:X: AC naikei of last row)
(used only as passed argument)
(#21:U: depth of dimple)

(as LHS)
(#30, #31, #32, #33)


(Common variables)
(as RHS)
(#431, #432, #433, #717, #768)
(as LHS)
(#734-#739, #900101-#900200 ,#900201-#900300)


(System variables)
(#3000: alarm)
(#4111: current H#)
(#5002: current work block end point Y)
(#5003: current work block end point Z)


(Subprograms)
(O230001, O630001)


(Passed arguments)
(#21, #33, #900101-#900200 ,#900201-#900300)


(Used variables in other programs)
(#717: O210000)
(#768: O230001)
%