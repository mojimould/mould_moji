%
O140001 (X center: left side measurement)

#33=#4012
#32=#5001
(#33= current work coordinate G#)
(#32= current work block end X)

IF[#33LT54]GOTO800
IF[#33GT59]GOTO800
(if work G# < 54 go to N800)
(if work G# > 59 go to N800)

IF[#24EQ#0]GOTO800
IF[#24LE0]GOTO800
IF[#26EQ#0]GOTO800
IF[#20EQ#0]GOTO800
IF[#20LE0]GOTO800
IF[#03EQ#0]GOTO800
IF[#03EQ0]GOTO800
IF[#01EQ#0]GOTO800
IF[#01LE0]GOTO800
(if X <= 0 or #0, go to N800)
(if Z = #0 go to, N800)
(if T <= 0 or #0, go to N800)
(if C = 0 or #0, go to N800)
(if A <= 0 or #0, go to N800)

IF[#20LE#678]GOTO800
IF[#26LE[#901011/2]]GOTO800
IF[[ABS[#04]]GE#20]GOTO800
(if T <= M or #0, go to N800)
(if Z <= #901011/2, go to N800)
(if |I| >= T, go to N800)

IF[#901011EQ#0]GOTO800
IF[#901011LE0]GOTO800
IF[#512EQ#0]GOTO800
IF[#512LE0]GOTO800
IF[#514NE50]GOTO800
IF[#678LT0]GOTO800
(if #901011 <= 0 or #0 go to N800)
(if #512 <= 0 or #0 go to N800)
(if #514 is not 50.0 go to N800)
(if mekki < 0, go to N800)

IF[#03GT0]GOTO001
(if C > 0, go to N001)
#31=-1 (for Bot)
GOTO002
N001
#31=1 (for Top)

N002
#30=[#24/2]-[#20+#04]+#678
IF[#30LE0]GOTO800
(#30=X/2-[T+I]+mekki)
(if #30 <= 0, go to 800)

IF[#1005EQ1]GOTO801
IF[#1004EQ1]GOTO003
(if low battery, go to N801)
(if current sensor ON, go to N003)
M117 (sensor on/off)
G04 X1. (wait 1.0s)

N003
G90 G31 Z[#26-#512] F1500
(Z skip tanmen: Z - D/2)
IF[#5003GT[#26-#512]]GOTO802
(if skip block end Z > tanmen Z - D/2, to N802)

G91 G31 X[#31*[#30-#512-#01]] F1500
(X skip: #31*[#30-D/2-A])
IF[[ABS[#5001-#32]+0.001]LT[ABS[#30-#512-#01]]]GOTO803
(if |skipX-#32| < |#30-D/2-A| to N803)

G91 G31 X[#31*#01*2] F#514
(X skip: #31*2A)
#900021=#5001+#502+#31*[#512-#501]
(#900021= block end X +#502+#31*[D/2-#501])

G91 G01 X[#31*[-#30+#512-#501]+#502] F3600
(X to measured center)

IF[[ABS[#900021-#502]]GE[ABS[#30+#01-#501]]]GOTO800
(if |#900021-#502|>=|#30-A-#501|, go to N800)

#[5201+[#33-53]*20]=#5021
(current work origin X = current machine coordinate X)

G90 G01 Z[#26+#601] F5400
GOTO999


N801
#3000=145 (sensor low battery)
M00 (ALARM: low battery)
GOTO999

N803
G90 G01 X#32 F5400 (X to start point)

N802
G91 G28 Z0
G65 P910002 (sensor OFF)

N800 #3000=121 (Argument Is Not Assigned)
M00 (are arguments ok?)

N999 M99

(Used Variables and Programs)

(Local variables)
(as received arguments)
(#01:A: skip kaishi kyori)
(#03:C: +: for Top, -: for Bot)
(#04:I: T +hosei)
(#20:T: A nikuatsu)
(#24:X: AC gaisakuKei)
(#26:Z: sokutei point Z)

(as LHS)
(#30, #31, #32, #33)


(Common variables)
(as LHS)
(#900021)
(as RHS)
(#601, #901011)
(#501: hosei: touch sensor signal delay)
(#502: hosei: probe center X)
(#512: probe radius)
(#514: default skip speed)
(#678: mekki mm)


(System variables)
(#0   : empty)
(#1004: 0: sensor off, 1: on)
(#1005: 0: sensor battery ok, 1: low battery)
(#2050: hosei #50 KouguChou)
(#3000: alarm)
(#4012: current work coordinate G#)
(#5001: current work block end point X)
(#5003: current work block end point Z)
(#5021: current machine coordinate X)
(#5221: G54 X)
(#5261: G56 X)


(Subprogram)
(O910002)
%